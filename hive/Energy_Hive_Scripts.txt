CREATE EXTERNAL TABLE ext_non_domestic_energy(
LMK_KEY	string,
ADDRESS1 string,	
ADDRESS2 string,	
ADDRESS3 string,	
POSTCODE string,	
BUILDING_REFERENCE_NUMBER string,	
ASSET_RATING string,	
ASSET_RATING_BAND string,	
PROPERTY_TYPE string,	
INSPECTION_DATE string,	
LOCAL_AUTHORITY string,	
CONSTITUENCY string,	
COUNTY string,	
LODGEMENT_DATE string,	
TRANSACTION_TYPE string,	
NEW_BUILD_BENCHMARK string,	
EXISTING_STOCK_BENCHMARK string,	
BUILDING_LEVEL string,	
MAIN_HEATING_FUEL string,	
OTHER_FUEL_DESC string,	
SPECIAL_ENERGY_USES string,	
RENEWABLE_SOURCES string,	
FLOOR_AREA string,	
STANDARD_EMISSIONS string,	
TARGET_EMISSIONS string,	
TYPICAL_EMISSIONS string,	
BUILDING_EMISSIONS	string,
AIRCON_PRESENT string,	
AIRCON_KW_RATING string,	
ESTIMATED_AIRCON_KW_RATING string,	
AC_INSPECTION_COMMISSIONED string,	
BUILDING_ENVIRONMENT string,	
ADDRESS	string,
LOCAL_AUTHORITY_LABEL string,	
CONSTITUENCY_LABEL string,	
CERTIFICATE_HASH string
) 
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
	WITH SERDEPROPERTIES (
	   "separatorChar" = ',',
	   "quoteChar"     = '\"',
	   "escapeChar"    = '\\'
	)  
	STORED AS TEXTFILE
	LOCATION '/tmp/energydataset/all-non-domestic-certificates/';

//Save the result from this table where lmk_key <> 'LMK_KEY' to a location and move into HDFS and then point an external table on it
-----------------------------------

CREATE EXTERNAL TABLE non_domestic_energy(
LMK_KEY	string,
ADDRESS1 string,	
ADDRESS2 string,	
ADDRESS3 string,	
POSTCODE string,	
BUILDING_REFERENCE_NUMBER string,	
ASSET_RATING string,	
ASSET_RATING_BAND string,	
PROPERTY_TYPE string,	
INSPECTION_DATE string,	
LOCAL_AUTHORITY string,	
CONSTITUENCY string,	
COUNTY string,	
LODGEMENT_DATE string,	
TRANSACTION_TYPE string,	
NEW_BUILD_BENCHMARK string,	
EXISTING_STOCK_BENCHMARK string,	
BUILDING_LEVEL string,	
MAIN_HEATING_FUEL string,	
OTHER_FUEL_DESC string,	
SPECIAL_ENERGY_USES string,	
RENEWABLE_SOURCES string,	
FLOOR_AREA string,	
STANDARD_EMISSIONS string,	
TARGET_EMISSIONS string,	
TYPICAL_EMISSIONS string,	
BUILDING_EMISSIONS	string,
AIRCON_PRESENT string,	
AIRCON_KW_RATING string,	
ESTIMATED_AIRCON_KW_RATING string,	
AC_INSPECTION_COMMISSIONED string,	
BUILDING_ENVIRONMENT string,	
ADDRESS	string,
LOCAL_AUTHORITY_LABEL string,	
CONSTITUENCY_LABEL string,	
CERTIFICATE_HASH string
) ROW FORMAT DELIMITED FIELDS TERMINATED BY "\t"  LOCATION '/grosvenor/energy/nondomestic/'

-------------------------------------------------------------

	CREATE EXTERNAL TABLE ext_display_energy(
	LMK_KEY string,
	ADDRESS1 string,
	ADDRESS2 string,
	ADDRESS3 string,
	POSTCODE string,
	BUILDING_REFERENCE_NUMBER string,
	CURRENT_OPERATIONAL_RATING string,
	YR1_OPERATIONAL_RATING string,
	YR2_OPERATIONAL_RATING string,
	OPERATIONAL_RATING_BAND string,
	ELECTRIC_CO2 string,
	HEATING_CO2 string,
	RENEWABLES_CO2 string,
	PROPERTY_TYPE string,
	INSPECTION_DATE string,
	LOCAL_AUTHORITY string,
	CONSTITUENCY string,
	COUNTY string,
	LODGEMENT_DATE string,
	MAIN_BENCHMARK string,
	MAIN_HEATING_FUEL string,
	OTHER_FUEL string,
	SPECIAL_ENERGY_USES string,
	RENEWABLE_SOURCES string,
	TOTAL_FLOOR_AREA string,
	ANNUAL_THERMAL_FUEL_USAGE string,
	TYPICAL_THERMAL_FUEL_USAGE string,
	ANNUAL_ELECTRICAL_FUEL_USAGE string,
	TYPICAL_ELECTRICAL_FUEL_USAGE string,
	RENEWABLES_FUEL_THERMAL string,
	RENEWABLES_ELECTRICAL string,
	YR1_ELECTRICITY_CO2 string,
	YR2_ELECTRICITY_CO2 string,
	YR1_HEATING_CO2 string,
	YR2_HEATING_CO2 string,
	YR1_RENEWABLES_CO2 string,
	YR2_RENEWABLES_CO2 string,
	AIRCON_PRESENT string,
	AIRCON_KW_RATING string,
	ESTIMATED_AIRCON_KW_RATING string,
	AC_INSPECTION_COMMISSIONED string,
	BUILDING_ENVIRONMENT string,
	BUILDING_CATEGORY string,
	ADDRESS string,
	LOCAL_AUTHORITY_LABEL string,
	CONSTITUENCY_LABEL string,
	CERTIFICATE_HASH string)
	 ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
	WITH SERDEPROPERTIES (
	   "separatorChar" = ',',
	   "quoteChar"     = '\"',
	   "escapeChar"    = '\\'
	)  
	STORED AS TEXTFILE
	LOCATION '/tmp/energydataset/display/displayenergy.csv';
	
	------------------------------------------------------------------
	CREATE EXTERNAL TABLE display_energy(
	LMK_KEY string,
	ADDRESS1 string,
	ADDRESS2 string,
	ADDRESS3 string,
	POSTCODE string,
	BUILDING_REFERENCE_NUMBER string,
	CURRENT_OPERATIONAL_RATING string,
	YR1_OPERATIONAL_RATING string,
	YR2_OPERATIONAL_RATING string,
	OPERATIONAL_RATING_BAND string,
	ELECTRIC_CO2 string,
	HEATING_CO2 string,
	RENEWABLES_CO2 string,
	PROPERTY_TYPE string,
	INSPECTION_DATE string,
	LOCAL_AUTHORITY string,
	CONSTITUENCY string,
	COUNTY string,
	LODGEMENT_DATE string,
	MAIN_BENCHMARK string,
	MAIN_HEATING_FUEL string,
	OTHER_FUEL string,
	SPECIAL_ENERGY_USES string,
	RENEWABLE_SOURCES string,
	TOTAL_FLOOR_AREA string,
	ANNUAL_THERMAL_FUEL_USAGE string,
	TYPICAL_THERMAL_FUEL_USAGE string,
	ANNUAL_ELECTRICAL_FUEL_USAGE string,
	TYPICAL_ELECTRICAL_FUEL_USAGE string,
	RENEWABLES_FUEL_THERMAL string,
	RENEWABLES_ELECTRICAL string,
	YR1_ELECTRICITY_CO2 string,
	YR2_ELECTRICITY_CO2 string,
	YR1_HEATING_CO2 string,
	YR2_HEATING_CO2 string,
	YR1_RENEWABLES_CO2 string,
	YR2_RENEWABLES_CO2 string,
	AIRCON_PRESENT string,
	AIRCON_KW_RATING string,
	ESTIMATED_AIRCON_KW_RATING string,
	AC_INSPECTION_COMMISSIONED string,
	BUILDING_ENVIRONMENT string,
	BUILDING_CATEGORY string,
	ADDRESS string,
	LOCAL_AUTHORITY_LABEL string,
	CONSTITUENCY_LABEL string,
	CERTIFICATE_HASH string)
	 ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t' 
	LOCATION '/grosvenor/energy/display';
	
	------------------------------------------------------------
	
		CREATE EXTERNAL TABLE ext_domestic_london_energy(
		LMK_KEY string,
		ADDRESS1 string,
		ADDRESS2 string,
		ADDRESS3 string,
		POSTCODE string,
		BUILDING_REFERENCE_NUMBER string,
		CURRENT_ENERGY_RATING string,
		POTENTIAL_ENERGY_RATING string,
		CURRENT_ENERGY_EFFICIENCY string,
		POTENTIAL_ENERGY_EFFICIENCY string,
		PROPERTY_TYPE string,
		BUILT_FORM string,
		INSPECTION_DATE string,
		LOCAL_AUTHORITY string,
		CONSTITUENCY string,
		COUNTY string,
		LODGEMENT_DATE string,
		TRANSACTION_TYPE string,
		ENVIRONMENT_IMPACT_CURRENT string,
		ENVIRONMENT_IMPACT_POTENTIAL string,
		ENERGY_CONSUMPTION_CURRENT string,
		ENERGY_CONSUMPTION_POTENTIAL string,
		CO2_EMISSIONS_CURRENT string,
		CO2_EMISS_CURR_PER_FLOOR_AREA string,
		CO2_EMISSIONS_POTENTIAL string,
		LIGHTING_COST_CURRENT string,
		LIGHTING_COST_POTENTIAL string,
		HEATING_COST_CURRENT string,
		HEATING_COST_POTENTIAL string,
		HOT_WATER_COST_CURRENT string,
		HOT_WATER_COST_POTENTIAL string,
		TOTAL_FLOOR_AREA string,
		ENERGY_TARIFF string,
		MAINS_GAS_FLAG string,
		FLOOR_LEVEL string,
		FLAT_TOP_STOREY string,
		FLAT_STOREY_COUNT string,
		MAIN_HEATING_CONTROLS string,
		MULTI_GLAZE_PROPORTION string,
		GLAZED_TYPE string,
		GLAZED_AREA string,
		EXTENSION_COUNT string,
		NUMBER_HABITABLE_ROOMS string,
		NUMBER_HEATED_ROOMS string,
		LOW_ENERGY_LIGHTING string,
		NUMBER_OPEN_FIREPLACES string,
		HOTWATER_DESCRIPTION string,
		HOT_WATER_ENERGY_EFF string,
		HOT_WATER_ENV_EFF string,
		FLOOR_DESCRIPTION string,
		FLOOR_ENERGY_EFF string,
		FLOOR_ENV_EFF string,
		WINDOWS_DESCRIPTION string,
		WINDOWS_ENERGY_EFF string,
		WINDOWS_ENV_EFF string,
		WALLS_DESCRIPTION string,
		WALLS_ENERGY_EFF string,
		WALLS_ENV_EFF string,
		SECONDHEAT_DESCRIPTION string,
		SHEATING_ENERGY_EFF string,
		SHEATING_ENV_EFF string,
		ROOF_DESCRIPTION string,
		ROOF_ENERGY_EFF string,
		ROOF_ENV_EFF string,
		MAINHEAT_DESCRIPTION string,
		MAINHEAT_ENERGY_EFF string,
		MAINHEAT_ENV_EFF string,
		MAINHEATCONT_DESCRIPTION string,
		MAINHEATC_ENERGY_EFF string,
		MAINHEATC_ENV_EFF string,
		LIGHTING_DESCRIPTION string,
		LIGHTING_ENERGY_EFF string,
		LIGHTING_ENV_EFF string,
		MAIN_FUEL string,
		WIND_TURBINE_COUNT string,
		HEAT_LOSS_CORRIDOOR string,
		UNHEATED_CORRIDOR_LENGTH string,
		FLOOR_HEIGHT string,
		PHOTO_SUPPLY string,
		SOLAR_WATER_HEATING_FLAG string,
		MECHANICAL_VENTILATION string,
		ADDRESS string,
		LOCAL_AUTHORITY_LABEL string,
		CONSTITUENCY_LABEL string,
		CERTIFICATE_HASH string
		)
		ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
		WITH SERDEPROPERTIES (
		   "separatorChar" = ',',
		   "quoteChar"     = '\"',
		   "escapeChar"    = '\\'
		)  
		STORED AS TEXTFILE
		LOCATION '/tmp/energydataset/';
	
	----------------------------------------------------------------------------------------------
	
	//HIVE DYNAMIC PARTITION TABLE - (Didnt worked because of Java Out of Memory Exception)
	
		CREATE TABLE domestic_energy(
	LMK_KEY string,
	ADDRESS1 string,
	ADDRESS2 string,
	ADDRESS3 string,
	POSTCODE string,
	BUILDING_REFERENCE_NUMBER string,
	CURRENT_ENERGY_RATING string,
	POTENTIAL_ENERGY_RATING string,
	CURRENT_ENERGY_EFFICIENCY string,
	POTENTIAL_ENERGY_EFFICIENCY string,
	PROPERTY_TYPE string,
	BUILT_FORM string,
	INSPECTION_DATE string,
	LOCAL_AUTHORITY string,
	CONSTITUENCY string,
	COUNTY string,
	LODGEMENT_DATE string,
	TRANSACTION_TYPE string,
	ENVIRONMENT_IMPACT_CURRENT string,
	ENVIRONMENT_IMPACT_POTENTIAL string,
	ENERGY_CONSUMPTION_CURRENT string,
	ENERGY_CONSUMPTION_POTENTIAL string,
	CO2_EMISSIONS_CURRENT string,
	CO2_EMISS_CURR_PER_FLOOR_AREA string,
	CO2_EMISSIONS_POTENTIAL string,
	LIGHTING_COST_CURRENT string,
	LIGHTING_COST_POTENTIAL string,
	HEATING_COST_CURRENT string,
	HEATING_COST_POTENTIAL string,
	HOT_WATER_COST_CURRENT string,
	HOT_WATER_COST_POTENTIAL string,
	TOTAL_FLOOR_AREA string,
	ENERGY_TARIFF string,
	MAINS_GAS_FLAG string,
	FLOOR_LEVEL string,
	FLAT_TOP_STOREY string,
	FLAT_STOREY_COUNT string,
	MAIN_HEATING_CONTROLS string,
	MULTI_GLAZE_PROPORTION string,
	GLAZED_TYPE string,
	GLAZED_AREA string,
	EXTENSION_COUNT string,
	NUMBER_HABITABLE_ROOMS string,
	NUMBER_HEATED_ROOMS string,
	LOW_ENERGY_LIGHTING string,
	NUMBER_OPEN_FIREPLACES string,
	HOTWATER_DESCRIPTION string,
	HOT_WATER_ENERGY_EFF string,
	HOT_WATER_ENV_EFF string,
	FLOOR_DESCRIPTION string,
	FLOOR_ENERGY_EFF string,
	FLOOR_ENV_EFF string,
	WINDOWS_DESCRIPTION string,
	WINDOWS_ENERGY_EFF string,
	WINDOWS_ENV_EFF string,
	WALLS_DESCRIPTION string,
	WALLS_ENERGY_EFF string,
	WALLS_ENV_EFF string,
	SECONDHEAT_DESCRIPTION string,
	SHEATING_ENERGY_EFF string,
	SHEATING_ENV_EFF string,
	ROOF_DESCRIPTION string,
	ROOF_ENERGY_EFF string,
	ROOF_ENV_EFF string,
	MAINHEAT_DESCRIPTION string,
	MAINHEAT_ENERGY_EFF string,
	MAINHEAT_ENV_EFF string,
	MAINHEATCONT_DESCRIPTION string,
	MAINHEATC_ENERGY_EFF string,
	MAINHEATC_ENV_EFF string,
	LIGHTING_DESCRIPTION string,
	LIGHTING_ENERGY_EFF string,
	LIGHTING_ENV_EFF string,
	MAIN_FUEL string,
	WIND_TURBINE_COUNT string,
	HEAT_LOSS_CORRIDOOR string,
	UNHEATED_CORRIDOR_LENGTH string,
	FLOOR_HEIGHT string,
	PHOTO_SUPPLY string,
	SOLAR_WATER_HEATING_FLAG string,
	MECHANICAL_VENTILATION string,
	ADDRESS string,
	CONSTITUENCY_LABEL string,
	CERTIFICATE_HASH string
	)
	PARTITIONED BY(LOCAL_AUTHORITY_LABEL string)
	STORED AS TEXTFILE;
	
	INSERT INTO TABLE domestic_energy PARTITION(LOCAL_AUTHORITY_LABEL) 
	SELECT 
	LMK_KEY,
	ADDRESS1,
	ADDRESS2,
	ADDRESS3,
	POSTCODE,
	BUILDING_REFERENCE_NUMBER,
	CURRENT_ENERGY_RATING,
	POTENTIAL_ENERGY_RATING,
	CURRENT_ENERGY_EFFICIENCY,
	POTENTIAL_ENERGY_EFFICIENCY,
	PROPERTY_TYPE,
	BUILT_FORM,
	INSPECTION_DATE,
	LOCAL_AUTHORITY,
	CONSTITUENCY,
	COUNTY,
	LODGEMENT_DATE,
	TRANSACTION_TYPE,
	ENVIRONMENT_IMPACT_CURRENT,
	ENVIRONMENT_IMPACT_POTENTIAL,
	ENERGY_CONSUMPTION_CURRENT,
	ENERGY_CONSUMPTION_POTENTIAL,
	CO2_EMISSIONS_CURRENT,
	CO2_EMISS_CURR_PER_FLOOR_AREA,
	CO2_EMISSIONS_POTENTIAL,
	LIGHTING_COST_CURRENT,
	LIGHTING_COST_POTENTIAL,
	HEATING_COST_CURRENT,
	HEATING_COST_POTENTIAL,
	HOT_WATER_COST_CURRENT,
	HOT_WATER_COST_POTENTIAL,
	TOTAL_FLOOR_AREA,
	ENERGY_TARIFF,
	MAINS_GAS_FLAG,
	FLOOR_LEVEL,
	FLAT_TOP_STOREY,
	FLAT_STOREY_COUNT,
	MAIN_HEATING_CONTROLS,
	MULTI_GLAZE_PROPORTION,
	GLAZED_TYPE,
	GLAZED_AREA,
	EXTENSION_COUNT,
	NUMBER_HABITABLE_ROOMS,
	NUMBER_HEATED_ROOMS,
	LOW_ENERGY_LIGHTING,
	NUMBER_OPEN_FIREPLACES,
	HOTWATER_DESCRIPTION,
	HOT_WATER_ENERGY_EFF,
	HOT_WATER_ENV_EFF,
	FLOOR_DESCRIPTION,
	FLOOR_ENERGY_EFF,
	FLOOR_ENV_EFF,
	WINDOWS_DESCRIPTION,
	WINDOWS_ENERGY_EFF,
	WINDOWS_ENV_EFF,
	WALLS_DESCRIPTION,
	WALLS_ENERGY_EFF,
	WALLS_ENV_EFF,
	SECONDHEAT_DESCRIPTION,
	SHEATING_ENERGY_EFF,
	SHEATING_ENV_EFF,
	ROOF_DESCRIPTION,
	ROOF_ENERGY_EFF,
	ROOF_ENV_EFF,
	MAINHEAT_DESCRIPTION,
	MAINHEAT_ENERGY_EFF,
	MAINHEAT_ENV_EFF,
	MAINHEATCONT_DESCRIPTION,
	MAINHEATC_ENERGY_EFF,
	MAINHEATC_ENV_EFF,
	LIGHTING_DESCRIPTION,
	LIGHTING_ENERGY_EFF,
	LIGHTING_ENV_EFF,
	MAIN_FUEL,
	WIND_TURBINE_COUNT,
	HEAT_LOSS_CORRIDOOR,
	UNHEATED_CORRIDOR_LENGTH,
	FLOOR_HEIGHT,
	PHOTO_SUPPLY,
	SOLAR_WATER_HEATING_FLAG,
	MECHANICAL_VENTILATION,
	ADDRESS,
	LOCAL_AUTHORITY_LABEL,
	CONSTITUENCY_LABEL,
	CERTIFICATE_HASH FROM ext_domestic_london_energy where lmk_key <> 'LMK_KEY';
	
	------------------------------------------------------
	//Drill Parquet table created 
	ALTER SESSION SET `store.format` = 'parquet'
	
	
	CREATE TABLE `dfs`.`default`.`DomesticEnergy_London`
(
	LMK_KEY,
	ADDRESS1,
	ADDRESS2,
	ADDRESS3,
	POSTCODE,
	BUILDING_REFERENCE_NUMBER,
	CURRENT_ENERGY_RATING,
	POTENTIAL_ENERGY_RATING,
	CURRENT_ENERGY_EFFICIENCY,
	POTENTIAL_ENERGY_EFFICIENCY,
	PROPERTY_TYPE,
	BUILT_FORM,
	INSPECTION_DATE,
	LOCAL_AUTHORITY,
	CONSTITUENCY,
	COUNTY,
	LODGEMENT_DATE,
	TRANSACTION_TYPE,
	ENVIRONMENT_IMPACT_CURRENT,
	ENVIRONMENT_IMPACT_POTENTIAL,
	ENERGY_CONSUMPTION_CURRENT,
	ENERGY_CONSUMPTION_POTENTIAL,
	CO2_EMISSIONS_CURRENT,
	CO2_EMISS_CURR_PER_FLOOR_AREA,
	CO2_EMISSIONS_POTENTIAL,
	LIGHTING_COST_CURRENT,
	LIGHTING_COST_POTENTIAL,
	HEATING_COST_CURRENT,
	HEATING_COST_POTENTIAL,
	HOT_WATER_COST_CURRENT,
	HOT_WATER_COST_POTENTIAL,
	TOTAL_FLOOR_AREA,
	ENERGY_TARIFF,
	MAINS_GAS_FLAG,
	FLOOR_LEVEL,
	FLAT_TOP_STOREY,
	FLAT_STOREY_COUNT,
	MAIN_HEATING_CONTROLS,
	MULTI_GLAZE_PROPORTION,
	GLAZED_TYPE,
	GLAZED_AREA,
	EXTENSION_COUNT,
	NUMBER_HABITABLE_ROOMS,
	NUMBER_HEATED_ROOMS,
	LOW_ENERGY_LIGHTING,
	NUMBER_OPEN_FIREPLACES,
	HOTWATER_DESCRIPTION,
	HOT_WATER_ENERGY_EFF,
	HOT_WATER_ENV_EFF,
	FLOOR_DESCRIPTION,
	FLOOR_ENERGY_EFF,
	FLOOR_ENV_EFF,
	WINDOWS_DESCRIPTION,
	WINDOWS_ENERGY_EFF,
	WINDOWS_ENV_EFF,
	WALLS_DESCRIPTION,
	WALLS_ENERGY_EFF,
	WALLS_ENV_EFF,
	SECONDHEAT_DESCRIPTION,
	SHEATING_ENERGY_EFF,
	SHEATING_ENV_EFF,
	ROOF_DESCRIPTION,
	ROOF_ENERGY_EFF,
	ROOF_ENV_EFF,
	MAINHEAT_DESCRIPTION,
	MAINHEAT_ENERGY_EFF,
	MAINHEAT_ENV_EFF,
	MAINHEATCONT_DESCRIPTION,
	MAINHEATC_ENERGY_EFF,
	MAINHEATC_ENV_EFF,
	LIGHTING_DESCRIPTION,
	LIGHTING_ENERGY_EFF,
	LIGHTING_ENV_EFF,
	MAIN_FUEL,
	WIND_TURBINE_COUNT,
	HEAT_LOSS_CORRIDOOR,
	UNHEATED_CORRIDOR_LENGTH,
	FLOOR_HEIGHT,
	PHOTO_SUPPLY,
	SOLAR_WATER_HEATING_FLAG,
	MECHANICAL_VENTILATION,
	ADDRESS,
	LOCAL_AUTHORITY_LABEL,
	CONSTITUENCY_LABEL,
	CERTIFICATE_HASH
) PARTITION BY(LOCAL_AUTHORITY_LABEL) AS
SELECT 
	LMK_KEY,
	ADDRESS1,
	ADDRESS2,
	ADDRESS3,
	POSTCODE,
	BUILDING_REFERENCE_NUMBER,
	CURRENT_ENERGY_RATING,
	POTENTIAL_ENERGY_RATING,
	CURRENT_ENERGY_EFFICIENCY,
	POTENTIAL_ENERGY_EFFICIENCY,
	PROPERTY_TYPE,
	BUILT_FORM,
	INSPECTION_DATE,
	LOCAL_AUTHORITY,
	CONSTITUENCY,
	COUNTY,
	LODGEMENT_DATE,
	TRANSACTION_TYPE,
	ENVIRONMENT_IMPACT_CURRENT,
	ENVIRONMENT_IMPACT_POTENTIAL,
	ENERGY_CONSUMPTION_CURRENT,
	ENERGY_CONSUMPTION_POTENTIAL,
	CO2_EMISSIONS_CURRENT,
	CO2_EMISS_CURR_PER_FLOOR_AREA,
	CO2_EMISSIONS_POTENTIAL,
	LIGHTING_COST_CURRENT,
	LIGHTING_COST_POTENTIAL,
	HEATING_COST_CURRENT,
	HEATING_COST_POTENTIAL,
	HOT_WATER_COST_CURRENT,
	HOT_WATER_COST_POTENTIAL,
	TOTAL_FLOOR_AREA,
	ENERGY_TARIFF,
	MAINS_GAS_FLAG,
	FLOOR_LEVEL,
	FLAT_TOP_STOREY,
	FLAT_STOREY_COUNT,
	MAIN_HEATING_CONTROLS,
	MULTI_GLAZE_PROPORTION,
	GLAZED_TYPE,
	GLAZED_AREA,
	EXTENSION_COUNT,
	NUMBER_HABITABLE_ROOMS,
	NUMBER_HEATED_ROOMS,
	LOW_ENERGY_LIGHTING,
	NUMBER_OPEN_FIREPLACES,
	HOTWATER_DESCRIPTION,
	HOT_WATER_ENERGY_EFF,
	HOT_WATER_ENV_EFF,
	FLOOR_DESCRIPTION,
	FLOOR_ENERGY_EFF,
	FLOOR_ENV_EFF,
	WINDOWS_DESCRIPTION,
	WINDOWS_ENERGY_EFF,
	WINDOWS_ENV_EFF,
	WALLS_DESCRIPTION,
	WALLS_ENERGY_EFF,
	WALLS_ENV_EFF,
	SECONDHEAT_DESCRIPTION,
	SHEATING_ENERGY_EFF,
	SHEATING_ENV_EFF,
	ROOF_DESCRIPTION,
	ROOF_ENERGY_EFF,
	ROOF_ENV_EFF,
	MAINHEAT_DESCRIPTION,
	MAINHEAT_ENERGY_EFF,
	MAINHEAT_ENV_EFF,
	MAINHEATCONT_DESCRIPTION,
	MAINHEATC_ENERGY_EFF,
	MAINHEATC_ENV_EFF,
	LIGHTING_DESCRIPTION,
	LIGHTING_ENERGY_EFF,
	LIGHTING_ENV_EFF,
	MAIN_FUEL,
	WIND_TURBINE_COUNT,
	HEAT_LOSS_CORRIDOOR,
	UNHEATED_CORRIDOR_LENGTH,
	FLOOR_HEIGHT,
	PHOTO_SUPPLY,
	SOLAR_WATER_HEATING_FLAG,
	MECHANICAL_VENTILATION,
	ADDRESS,
	LOCAL_AUTHORITY_LABEL,
	CONSTITUENCY_LABEL,
	CERTIFICATE_HASH FROM `hive_social_media`.`default`.`ext_domestic_london_energy` where lmk_key <> 'LMK_KEY'
	-----------------------------------------------------------------------------------------------
	
	//Liverpool
	
	CREATE EXTERNAL TABLE ext_domestic_liverpool_energy(
		LMK_KEY string,
		ADDRESS1 string,
		ADDRESS2 string,
		ADDRESS3 string,
		POSTCODE string,
		BUILDING_REFERENCE_NUMBER string,
		CURRENT_ENERGY_RATING string,
		POTENTIAL_ENERGY_RATING string,
		CURRENT_ENERGY_EFFICIENCY string,
		POTENTIAL_ENERGY_EFFICIENCY string,
		PROPERTY_TYPE string,
		BUILT_FORM string,
		INSPECTION_DATE string,
		LOCAL_AUTHORITY string,
		CONSTITUENCY string,
		COUNTY string,
		LODGEMENT_DATE string,
		TRANSACTION_TYPE string,
		ENVIRONMENT_IMPACT_CURRENT string,
		ENVIRONMENT_IMPACT_POTENTIAL string,
		ENERGY_CONSUMPTION_CURRENT string,
		ENERGY_CONSUMPTION_POTENTIAL string,
		CO2_EMISSIONS_CURRENT string,
		CO2_EMISS_CURR_PER_FLOOR_AREA string,
		CO2_EMISSIONS_POTENTIAL string,
		LIGHTING_COST_CURRENT string,
		LIGHTING_COST_POTENTIAL string,
		HEATING_COST_CURRENT string,
		HEATING_COST_POTENTIAL string,
		HOT_WATER_COST_CURRENT string,
		HOT_WATER_COST_POTENTIAL string,
		TOTAL_FLOOR_AREA string,
		ENERGY_TARIFF string,
		MAINS_GAS_FLAG string,
		FLOOR_LEVEL string,
		FLAT_TOP_STOREY string,
		FLAT_STOREY_COUNT string,
		MAIN_HEATING_CONTROLS string,
		MULTI_GLAZE_PROPORTION string,
		GLAZED_TYPE string,
		GLAZED_AREA string,
		EXTENSION_COUNT string,
		NUMBER_HABITABLE_ROOMS string,
		NUMBER_HEATED_ROOMS string,
		LOW_ENERGY_LIGHTING string,
		NUMBER_OPEN_FIREPLACES string,
		HOTWATER_DESCRIPTION string,
		HOT_WATER_ENERGY_EFF string,
		HOT_WATER_ENV_EFF string,
		FLOOR_DESCRIPTION string,
		FLOOR_ENERGY_EFF string,
		FLOOR_ENV_EFF string,
		WINDOWS_DESCRIPTION string,
		WINDOWS_ENERGY_EFF string,
		WINDOWS_ENV_EFF string,
		WALLS_DESCRIPTION string,
		WALLS_ENERGY_EFF string,
		WALLS_ENV_EFF string,
		SECONDHEAT_DESCRIPTION string,
		SHEATING_ENERGY_EFF string,
		SHEATING_ENV_EFF string,
		ROOF_DESCRIPTION string,
		ROOF_ENERGY_EFF string,
		ROOF_ENV_EFF string,
		MAINHEAT_DESCRIPTION string,
		MAINHEAT_ENERGY_EFF string,
		MAINHEAT_ENV_EFF string,
		MAINHEATCONT_DESCRIPTION string,
		MAINHEATC_ENERGY_EFF string,
		MAINHEATC_ENV_EFF string,
		LIGHTING_DESCRIPTION string,
		LIGHTING_ENERGY_EFF string,
		LIGHTING_ENV_EFF string,
		MAIN_FUEL string,
		WIND_TURBINE_COUNT string,
		HEAT_LOSS_CORRIDOOR string,
		UNHEATED_CORRIDOR_LENGTH string,
		FLOOR_HEIGHT string,
		PHOTO_SUPPLY string,
		SOLAR_WATER_HEATING_FLAG string,
		MECHANICAL_VENTILATION string,
		ADDRESS string,
		LOCAL_AUTHORITY_LABEL string,
		CONSTITUENCY_LABEL string,
		CERTIFICATE_HASH string
		)
		ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
		WITH SERDEPROPERTIES (
		   "separatorChar" = ',',
		   "quoteChar"     = '\"',
		   "escapeChar"    = '\\'
		)  
		STORED AS TEXTFILE
		LOCATION '/tmp/energydataset/domestic/Liverpool/';
		
---------------------------------------------------------------------------------------
//Drill query

	CREATE TABLE `dfs`.`default`.`DomesticEnergy_Liverpool`
(
	LMK_KEY,
	ADDRESS1,
	ADDRESS2,
	ADDRESS3,
	POSTCODE,
	BUILDING_REFERENCE_NUMBER,
	CURRENT_ENERGY_RATING,
	POTENTIAL_ENERGY_RATING,
	CURRENT_ENERGY_EFFICIENCY,
	POTENTIAL_ENERGY_EFFICIENCY,
	PROPERTY_TYPE,
	BUILT_FORM,
	INSPECTION_DATE,
	LOCAL_AUTHORITY,
	CONSTITUENCY,
	COUNTY,
	LODGEMENT_DATE,
	TRANSACTION_TYPE,
	ENVIRONMENT_IMPACT_CURRENT,
	ENVIRONMENT_IMPACT_POTENTIAL,
	ENERGY_CONSUMPTION_CURRENT,
	ENERGY_CONSUMPTION_POTENTIAL,
	CO2_EMISSIONS_CURRENT,
	CO2_EMISS_CURR_PER_FLOOR_AREA,
	CO2_EMISSIONS_POTENTIAL,
	LIGHTING_COST_CURRENT,
	LIGHTING_COST_POTENTIAL,
	HEATING_COST_CURRENT,
	HEATING_COST_POTENTIAL,
	HOT_WATER_COST_CURRENT,
	HOT_WATER_COST_POTENTIAL,
	TOTAL_FLOOR_AREA,
	ENERGY_TARIFF,
	MAINS_GAS_FLAG,
	FLOOR_LEVEL,
	FLAT_TOP_STOREY,
	FLAT_STOREY_COUNT,
	MAIN_HEATING_CONTROLS,
	MULTI_GLAZE_PROPORTION,
	GLAZED_TYPE,
	GLAZED_AREA,
	EXTENSION_COUNT,
	NUMBER_HABITABLE_ROOMS,
	NUMBER_HEATED_ROOMS,
	LOW_ENERGY_LIGHTING,
	NUMBER_OPEN_FIREPLACES,
	HOTWATER_DESCRIPTION,
	HOT_WATER_ENERGY_EFF,
	HOT_WATER_ENV_EFF,
	FLOOR_DESCRIPTION,
	FLOOR_ENERGY_EFF,
	FLOOR_ENV_EFF,
	WINDOWS_DESCRIPTION,
	WINDOWS_ENERGY_EFF,
	WINDOWS_ENV_EFF,
	WALLS_DESCRIPTION,
	WALLS_ENERGY_EFF,
	WALLS_ENV_EFF,
	SECONDHEAT_DESCRIPTION,
	SHEATING_ENERGY_EFF,
	SHEATING_ENV_EFF,
	ROOF_DESCRIPTION,
	ROOF_ENERGY_EFF,
	ROOF_ENV_EFF,
	MAINHEAT_DESCRIPTION,
	MAINHEAT_ENERGY_EFF,
	MAINHEAT_ENV_EFF,
	MAINHEATCONT_DESCRIPTION,
	MAINHEATC_ENERGY_EFF,
	MAINHEATC_ENV_EFF,
	LIGHTING_DESCRIPTION,
	LIGHTING_ENERGY_EFF,
	LIGHTING_ENV_EFF,
	MAIN_FUEL,
	WIND_TURBINE_COUNT,
	HEAT_LOSS_CORRIDOOR,
	UNHEATED_CORRIDOR_LENGTH,
	FLOOR_HEIGHT,
	PHOTO_SUPPLY,
	SOLAR_WATER_HEATING_FLAG,
	MECHANICAL_VENTILATION,
	ADDRESS,
	LOCAL_AUTHORITY_LABEL,
	CONSTITUENCY_LABEL,
	CERTIFICATE_HASH
) PARTITION BY(LOCAL_AUTHORITY_LABEL) AS
SELECT 
	LMK_KEY,
	ADDRESS1,
	ADDRESS2,
	ADDRESS3,
	POSTCODE,
	BUILDING_REFERENCE_NUMBER,
	CURRENT_ENERGY_RATING,
	POTENTIAL_ENERGY_RATING,
	CURRENT_ENERGY_EFFICIENCY,
	POTENTIAL_ENERGY_EFFICIENCY,
	PROPERTY_TYPE,
	BUILT_FORM,
	INSPECTION_DATE,
	LOCAL_AUTHORITY,
	CONSTITUENCY,
	COUNTY,
	LODGEMENT_DATE,
	TRANSACTION_TYPE,
	ENVIRONMENT_IMPACT_CURRENT,
	ENVIRONMENT_IMPACT_POTENTIAL,
	ENERGY_CONSUMPTION_CURRENT,
	ENERGY_CONSUMPTION_POTENTIAL,
	CO2_EMISSIONS_CURRENT,
	CO2_EMISS_CURR_PER_FLOOR_AREA,
	CO2_EMISSIONS_POTENTIAL,
	LIGHTING_COST_CURRENT,
	LIGHTING_COST_POTENTIAL,
	HEATING_COST_CURRENT,
	HEATING_COST_POTENTIAL,
	HOT_WATER_COST_CURRENT,
	HOT_WATER_COST_POTENTIAL,
	TOTAL_FLOOR_AREA,
	ENERGY_TARIFF,
	MAINS_GAS_FLAG,
	FLOOR_LEVEL,
	FLAT_TOP_STOREY,
	FLAT_STOREY_COUNT,
	MAIN_HEATING_CONTROLS,
	MULTI_GLAZE_PROPORTION,
	GLAZED_TYPE,
	GLAZED_AREA,
	EXTENSION_COUNT,
	NUMBER_HABITABLE_ROOMS,
	NUMBER_HEATED_ROOMS,
	LOW_ENERGY_LIGHTING,
	NUMBER_OPEN_FIREPLACES,
	HOTWATER_DESCRIPTION,
	HOT_WATER_ENERGY_EFF,
	HOT_WATER_ENV_EFF,
	FLOOR_DESCRIPTION,
	FLOOR_ENERGY_EFF,
	FLOOR_ENV_EFF,
	WINDOWS_DESCRIPTION,
	WINDOWS_ENERGY_EFF,
	WINDOWS_ENV_EFF,
	WALLS_DESCRIPTION,
	WALLS_ENERGY_EFF,
	WALLS_ENV_EFF,
	SECONDHEAT_DESCRIPTION,
	SHEATING_ENERGY_EFF,
	SHEATING_ENV_EFF,
	ROOF_DESCRIPTION,
	ROOF_ENERGY_EFF,
	ROOF_ENV_EFF,
	MAINHEAT_DESCRIPTION,
	MAINHEAT_ENERGY_EFF,
	MAINHEAT_ENV_EFF,
	MAINHEATCONT_DESCRIPTION,
	MAINHEATC_ENERGY_EFF,
	MAINHEATC_ENV_EFF,
	LIGHTING_DESCRIPTION,
	LIGHTING_ENERGY_EFF,
	LIGHTING_ENV_EFF,
	MAIN_FUEL,
	WIND_TURBINE_COUNT,
	HEAT_LOSS_CORRIDOOR,
	UNHEATED_CORRIDOR_LENGTH,
	FLOOR_HEIGHT,
	PHOTO_SUPPLY,
	SOLAR_WATER_HEATING_FLAG,
	MECHANICAL_VENTILATION,
	ADDRESS,
	LOCAL_AUTHORITY_LABEL,
	CONSTITUENCY_LABEL,
	CERTIFICATE_HASH FROM `hive_social_media`.`default`.`ext_domestic_liverpool_energy` where lmk_key <> 'LMK_KEY'
	
	---------------------------------------------------
	drop table ext_domestic_liverpool_energy;
	
	//Point External Hive table to parquet files to query
	CREATE EXTERNAL TABLE ext_domestic_liverpool_energy(
		LMK_KEY string,
		ADDRESS1 string,
		ADDRESS2 string,
		ADDRESS3 string,
		POSTCODE string,
		BUILDING_REFERENCE_NUMBER string,
		CURRENT_ENERGY_RATING string,
		POTENTIAL_ENERGY_RATING string,
		CURRENT_ENERGY_EFFICIENCY string,
		POTENTIAL_ENERGY_EFFICIENCY string,
		PROPERTY_TYPE string,
		BUILT_FORM string,
		INSPECTION_DATE string,
		LOCAL_AUTHORITY string,
		CONSTITUENCY string,
		COUNTY string,
		LODGEMENT_DATE string,
		TRANSACTION_TYPE string,
		ENVIRONMENT_IMPACT_CURRENT string,
		ENVIRONMENT_IMPACT_POTENTIAL string,
		ENERGY_CONSUMPTION_CURRENT string,
		ENERGY_CONSUMPTION_POTENTIAL string,
		CO2_EMISSIONS_CURRENT string,
		CO2_EMISS_CURR_PER_FLOOR_AREA string,
		CO2_EMISSIONS_POTENTIAL string,
		LIGHTING_COST_CURRENT string,
		LIGHTING_COST_POTENTIAL string,
		HEATING_COST_CURRENT string,
		HEATING_COST_POTENTIAL string,
		HOT_WATER_COST_CURRENT string,
		HOT_WATER_COST_POTENTIAL string,
		TOTAL_FLOOR_AREA string,
		ENERGY_TARIFF string,
		MAINS_GAS_FLAG string,
		FLOOR_LEVEL string,
		FLAT_TOP_STOREY string,
		FLAT_STOREY_COUNT string,
		MAIN_HEATING_CONTROLS string,
		MULTI_GLAZE_PROPORTION string,
		GLAZED_TYPE string,
		GLAZED_AREA string,
		EXTENSION_COUNT string,
		NUMBER_HABITABLE_ROOMS string,
		NUMBER_HEATED_ROOMS string,
		LOW_ENERGY_LIGHTING string,
		NUMBER_OPEN_FIREPLACES string,
		HOTWATER_DESCRIPTION string,
		HOT_WATER_ENERGY_EFF string,
		HOT_WATER_ENV_EFF string,
		FLOOR_DESCRIPTION string,
		FLOOR_ENERGY_EFF string,
		FLOOR_ENV_EFF string,
		WINDOWS_DESCRIPTION string,
		WINDOWS_ENERGY_EFF string,
		WINDOWS_ENV_EFF string,
		WALLS_DESCRIPTION string,
		WALLS_ENERGY_EFF string,
		WALLS_ENV_EFF string,
		SECONDHEAT_DESCRIPTION string,
		SHEATING_ENERGY_EFF string,
		SHEATING_ENV_EFF string,
		ROOF_DESCRIPTION string,
		ROOF_ENERGY_EFF string,
		ROOF_ENV_EFF string,
		MAINHEAT_DESCRIPTION string,
		MAINHEAT_ENERGY_EFF string,
		MAINHEAT_ENV_EFF string,
		MAINHEATCONT_DESCRIPTION string,
		MAINHEATC_ENERGY_EFF string,
		MAINHEATC_ENV_EFF string,
		LIGHTING_DESCRIPTION string,
		LIGHTING_ENERGY_EFF string,
		LIGHTING_ENV_EFF string,
		MAIN_FUEL string,
		WIND_TURBINE_COUNT string,
		HEAT_LOSS_CORRIDOOR string,
		UNHEATED_CORRIDOR_LENGTH string,
		FLOOR_HEIGHT string,
		PHOTO_SUPPLY string,
		SOLAR_WATER_HEATING_FLAG string,
		MECHANICAL_VENTILATION string,
		ADDRESS string,
		LOCAL_AUTHORITY_LABEL string,
		CONSTITUENCY_LABEL string,
		CERTIFICATE_HASH string
		)
		STORED AS PARQUET
		LOCATION '/grosvenor/DomesticEnergy_Liverpool/';
		
		
		CREATE EXTERNAL TABLE ext_domestic_london_energy(
		LMK_KEY string,
		ADDRESS1 string,
		ADDRESS2 string,
		ADDRESS3 string,
		POSTCODE string,
		BUILDING_REFERENCE_NUMBER string,
		CURRENT_ENERGY_RATING string,
		POTENTIAL_ENERGY_RATING string,
		CURRENT_ENERGY_EFFICIENCY string,
		POTENTIAL_ENERGY_EFFICIENCY string,
		PROPERTY_TYPE string,
		BUILT_FORM string,
		INSPECTION_DATE string,
		LOCAL_AUTHORITY string,
		CONSTITUENCY string,
		COUNTY string,
		LODGEMENT_DATE string,
		TRANSACTION_TYPE string,
		ENVIRONMENT_IMPACT_CURRENT string,
		ENVIRONMENT_IMPACT_POTENTIAL string,
		ENERGY_CONSUMPTION_CURRENT string,
		ENERGY_CONSUMPTION_POTENTIAL string,
		CO2_EMISSIONS_CURRENT string,
		CO2_EMISS_CURR_PER_FLOOR_AREA string,
		CO2_EMISSIONS_POTENTIAL string,
		LIGHTING_COST_CURRENT string,
		LIGHTING_COST_POTENTIAL string,
		HEATING_COST_CURRENT string,
		HEATING_COST_POTENTIAL string,
		HOT_WATER_COST_CURRENT string,
		HOT_WATER_COST_POTENTIAL string,
		TOTAL_FLOOR_AREA string,
		ENERGY_TARIFF string,
		MAINS_GAS_FLAG string,
		FLOOR_LEVEL string,
		FLAT_TOP_STOREY string,
		FLAT_STOREY_COUNT string,
		MAIN_HEATING_CONTROLS string,
		MULTI_GLAZE_PROPORTION string,
		GLAZED_TYPE string,
		GLAZED_AREA string,
		EXTENSION_COUNT string,
		NUMBER_HABITABLE_ROOMS string,
		NUMBER_HEATED_ROOMS string,
		LOW_ENERGY_LIGHTING string,
		NUMBER_OPEN_FIREPLACES string,
		HOTWATER_DESCRIPTION string,
		HOT_WATER_ENERGY_EFF string,
		HOT_WATER_ENV_EFF string,
		FLOOR_DESCRIPTION string,
		FLOOR_ENERGY_EFF string,
		FLOOR_ENV_EFF string,
		WINDOWS_DESCRIPTION string,
		WINDOWS_ENERGY_EFF string,
		WINDOWS_ENV_EFF string,
		WALLS_DESCRIPTION string,
		WALLS_ENERGY_EFF string,
		WALLS_ENV_EFF string,
		SECONDHEAT_DESCRIPTION string,
		SHEATING_ENERGY_EFF string,
		SHEATING_ENV_EFF string,
		ROOF_DESCRIPTION string,
		ROOF_ENERGY_EFF string,
		ROOF_ENV_EFF string,
		MAINHEAT_DESCRIPTION string,
		MAINHEAT_ENERGY_EFF string,
		MAINHEAT_ENV_EFF string,
		MAINHEATCONT_DESCRIPTION string,
		MAINHEATC_ENERGY_EFF string,
		MAINHEATC_ENV_EFF string,
		LIGHTING_DESCRIPTION string,
		LIGHTING_ENERGY_EFF string,
		LIGHTING_ENV_EFF string,
		MAIN_FUEL string,
		WIND_TURBINE_COUNT string,
		HEAT_LOSS_CORRIDOOR string,
		UNHEATED_CORRIDOR_LENGTH string,
		FLOOR_HEIGHT string,
		PHOTO_SUPPLY string,
		SOLAR_WATER_HEATING_FLAG string,
		MECHANICAL_VENTILATION string,
		ADDRESS string,
		LOCAL_AUTHORITY_LABEL string,
		CONSTITUENCY_LABEL string,
		CERTIFICATE_HASH string
		)
		STORED AS PARQUET
		LOCATION '/grosvenor/DomesticEnergy_London/';
		